\chapter{The NPS \LaTeX{} Template Package}
This chapter describes how to get the NPS report template and how to
use it.

\section{Getting the Template}
The template is distributed by the thesis processor on the
wiki page NPS wiki page\footnote{Available at \url{https://wiki.nps.edu/display/LaTexTP/LaTex+Thesis+Portal};
you may need an NPS network account to log-in and download it.}, distributed as the file |NPS_LaTeX_Template.zip|. 
Unpack this into a directory on your computer. This is where we will be working for the
remainder of this chapter.
Below you will find the important files distributed with the template package.

\begin{description}
\item[acronyms.tex*] \hfill \\ 
An example file for acronyms.
\item[appendix1.tex*] \hfill \\ 
An example file for an appendix.
\item[chapter1.tex*] \hfill \\ 
An example file for a chapter.
\item[thesis.bib*] \hfill \\ 
An example bibliography file
\item[thesis.tex*] \hfill \\ 
A skeletal thesis \LaTeX{} template file
\item[contribs/] \hfill \\ 
A directory of user-contributed tools related to thesis proposals and thesis preparation. None of these tools are required for using the basic template.
\item[doc/] \hfill \\ 
A directory, holds documentation for the template.
\item[examples/] \hfill \\ 
A directory, holds examples. These build via the Makefile. To use one, replace |thesis.tex| with one of these examples.
\item[figs/] \hfill \\
Images required to lay-out the thesis front-matter.
\item[nps\_sf298.sty] \hfill \\ 
The style file for preparing the SF298 form.
\item[nps\_thesis.bst] \hfill \\ 
A Bib\TeX{} style file that typesets references in a manner acceptable to NPS.
\item[npsreport.cls] \hfill \\ 
The \LaTeX{} class file for NPS documents.
\end{description}

It is intended that you edit or replace the starred files.



\section{NPS Thesis Sections}
When writing your thesis, the sections should be in this order:
\begin{enumerate}
  \item[] \hspace{-3em} \underline{\textit{Front-matter}}
  \item Cover Page
  \item Signature Page
  \item SF298
  \item Table of Contents
  \item List of Figures*
  \item List of Tables*
  \item List of Acronyms*
  \item Executive Summary*
  \item Acknowledgements*
  \item[] \hspace{-3em} \underline{\textit{Main Body}}
  \item Chapters
  \item[] \hspace{-3em} \underline{\textit{Back-matter}}
  \item Appendices
  \item Index*
  \item References
  \item Initial Distribution List
\end{enumerate}

The starred items do not appear in the Table of Contents.  Not all theses
will have an Index, but that can be generated automatically with
\LaTeX{}.  If your thesis only has one appendix, then it is not
lettered, but just referred to as the Appendix.  If you have multiple
appendices, then they are lettered.  If you do not have any tables,
then the list of tables is not included.  This also applies to list of
figures and acronyms.  An Executive Summary is required by
some departments.


\section{Creating Your Document}
The skeletal |thesis.tex| file contains example
text demonstrating macros that need to be filled-in to use the template.
For example, the command |\foo{|\textcolor{red}{\texttt{[sample text]}}|}|
is a macro named |foo| that you should modify, replacing
\textcolor{red}{\texttt{[sample text]}} with your own input. The proper way to edit this
is by changing it to be |\foo{real text}|, and \emph{not} |\foo{[real text]}|.

The |thesis.tex| file consists of two main parts: the
\emph{prologue} (everything before the |\begin{document}|) and the
\emph{body} (everything between the |\begin{document}| and the
|\end{document}|). The body is further split into three parts: the front-matter,
the main body and the back-matter (the appendices, bibliography, and
distribution list). You will typically create your thesis or technical
report by editing
each. Some students put their entire thesis into the |thesis.tex|
file, while others put each chapter into its own |.tex| file and
include them using the \verb|\include{filename.tex}| command.

The following sections annotate the commends found in the skeletal thesis template,
broken down into four parts (the prologue, front-matter, main body, back-matter), 
explaining the purpose of each command.


\section{The Prologue}\label{sec:prologue}
Below is the thesis prologue from the |thesis.tex| file, with comments to help read the code.
\input{code_preamble.tex}


\section{The Front-Matter}\label{sec:front}
Below is part of the thesis body from the |thesis.tex| file, with comments showing how
the thesis front-matter gets typeset:
\input{code_frontmatter.tex}


\section{The Main Body}\label{sec:main}
Below is part of the thesis body from the |thesis.tex| file, with comments showing how
the thesis main body gets typeset:
\input{code_body.tex}


\section{The Back-Matter}\label{sec:back}
Below is part of the thesis body from the |thesis.tex| file, with comments showing how
the thesis back-matter gets typeset, including
one or more appendices and a distribution list:
\input{code_backmatter.tex}


\section{Additional Commands Provided by the Template}
In additional to commands above, the NPS template provides additional
commands designed to make it easier to have references, tables,
figures, and embedded graphics.
\subsection{Labels}\label{refcommands}
Recall from \secref{sec:labels} that labels are hidden markers in your
|.tex| files created by |\label{name}|.  The NPS \LaTeX{} template contains a number of commands for
referencing labels in your text; they are presented below:

\begin{tabular}{lp{5in}}
\multicolumn{2}{l}{Built in to \LaTeX:}\\
|\ref{l}|     & General reference of the label that places the label's number in the document. \\  
\\
\multicolumn{2}{l}{Provided by \texttt{npsreport.cls}:}\\
|\chapref{l}| & Chapter reference that formats as ``Chapter 3'' \\  
|\secref{l}|  & Section reference that formats as ``Section 3.'' You can use this for sections, subsections, and so on. \\  
|\figref{l}|  & Figure reference that formats as ``Figure 3'' \\  
|\tabref{l}|  & Table reference that formats as ``Table 3'' \\  
|\eqnref{l}|  & Equation reference that formats as ``Equation (3.1)'' \\  
|\eqnsref{l,m}| & Equation reference that formats as ``Equations (3.1) and (3.5)'' \\  
|\appref{l}|  & Appendix reference that formats as ``Appendix 3'' \\  
\end{tabular}


\subsection{Tables and Figures}
Tables and figures are floating objects that \LaTeX{} moves around as
necessary to make your thesis look better. Tables are inserted with
the \verb|\begin{table}| command while figures are inserted with
\verb|\begin{figure}|. Here are some rules to consider:

\begin{itemize}
\item Every table and figure should have a caption, created with the
  |\caption{text}| command.
\item Every table and figure should have a unique label, created with
  the |\label{marker}| command.
\item Every table and figure should be referred to in the main body of
  your text. \LaTeX{} provides a command called |\ref{marker}|;
  this template provides additional commands |\tabref{marker}|
  and |\figref{marker}|. All of the reference commands are shown
  in \secvref{refcommands}.
\item Do not assume that figures and tables will be on the same text as your
  page. Always refer to the figures and tables by their numbering.
\end{itemize}


\subsection{Including Photos and Figures}\label{graphics}
The NPS report template uses the \LaTeX{} |graphicx| package to embed
photos and other graphics into the resulting document. You can include
graphics directly with the |\includegraphics| command or use the
commands described in this section.

\sgraphic{images/home_topimg.jpg}{Banner from the top of the NPS web site.}

By using the |\sgraphic{filename}{caption}| command provided by
|npsreport.cls|, you can embed a
photo from a given filename and give it a label and a caption. The
label is set to be the filename. Use the
|\figref{tag}| command to get an in-paragraph 
reference. \figref{images/home_topimg.jpg} shows an example of an
embedded image using \verb+\sgraphic+. The filename is |images/home_topimg.jpg|. It is embedded
with the command:

\begin{Verbatim}[fontsize=\small]
\sgraphic{images/home_topimg.jpg}{Banner from the top of the NPS web site.}
\end{Verbatim}

The figure can then be referenced with the command:

\begin{Verbatim}
\figref{images/home_topimg.jpg}
\end{Verbatim}


The variants of sgraphic are |b| for box, |n| for no box, |o| for boxed but not a figure, and |on| for no box and not a figure.

\sgraphicb[width=3in]{images/photo3}{Using sgraphicb (box)}
\sgraphicn[width=3in]{images/photo1}{Using sgraphicn (no box)}

Each of the \emph{sgraphic} commands have an optional parameter that
you can use to modify the image.  The |width| can be used to specify a
dimension on the page such as 3 inches or 10 centimeters.  The |scale|
can be used with either a number between 0 and 1 to scale down the
image or larger than 1 to magnify the image; magnification of
bitmapped images may look pixelated and print poorly if you are not
starting with an image that has sufficient resolution. If
you need a larger image, you should find a way to make it larger
before including it in your thesis.  The image can be rotated with
|angle|.

\begin{Verbatim}
\sgraphic[width=3in]{imagefile}{caption}
\sgraphicb[scale=0.5]{imagefile}{caption}
\sgraphicn[angle=270]{imagefile}{caption}
\sgraphico[width=2in]{imagefile}{caption}
\sgraphicon[width=10cm]{imagefile}{caption}
\end{Verbatim}

The |twofigures| command allows you to have two figures side-by-side, 
as shown in \figref{images/photo5} and \figref{images/photo6}.
An example of the |width1| and |width2| entries is 2.5in, 10cm, etc.

\twofigures{2.5in}{images/photo5}{Using twofigures}
           {2.5in}{images/photo6}{A second caption.}

\begin{Verbatim}
\twofigures{width1}{imagefile1}{caption1}
           {width2}{imagefile2}{caption2}
\end{Verbatim}

|\twoimages{imagefile1}{imagefile2}{caption}|
\twoimages{images/photo7}{images/photo8}{Using twoimages}

There are three additional commands to arrange text or images side by side.  These are 
advanced features.  See |npsreport.cls| for additional information.

\begin{Verbatim}
\sidebyside{contents1}{contents2}{caption}{label}|
\tsidebyside{contents1}{contents2}{caption}{label}|
\threesidebyside{contents1}{contents2}{contents3}{caption}{label}
\end{Verbatim}

\section{Ph.D. Dissertations}

The NPS \LaTeX{} template is also created for Ph.D. dissertations when using the |dissertation| option on the document class.  The signature page is very different from a Master's thesis.  Additional macros are available to make creating the signature page.  The following macros would all be placed into your primary |.tex| document before the |\begin{document}| (as in the prologue of \secref{thesisprologue}).

\begin{Verbatim}
\thesisadvisor{[Person 1]}
\committeechair{[Person 2]}
\memberThree{[Person 3]}
\memberFour{[Person 4]}
\memberFive{[Person 5]}
\memberSix{[Person 6]}
\end{Verbatim}

Most Ph.D. committees have no more than 6 members. The thesis advisor and committee chair are used as the first and second committee members, by default. If your committee has more than six members, you will still have to manually edit this signature page and expect difficulty in making everything fit on a single page.

The names of your committee members should be placed in these macros.  Usually your primary advisor is in the One entry. You should still provide the |\thesisadvisor{[ADVISOR]}| macro as well for this person.  Your committee may have guidance on the preferred order of appearance of the remaining members.

There is space for each advisor to have up to four lines for the title (this does not include their name), but you should manually decide where the put the line breaks using the |\\| command:

\begin{Verbatim}
\memberOneTitleLine{Dissertation Advisor\\ Professor, Department of\\ 
      Computer Science}
\end{Verbatim}

Similar macros exist for the other members: |memberTwoTitleLine|, \etc.

Two additional signatures are needed for a Ph.D. signature page.  

\begin{Verbatim}
\assocprovost{[Associate Provost]}
\departmentchair{[Department Chairman]}
\end{Verbatim}

You should speak to your primary advisor if you do not know the appropriate names to provide.

Ideally, the signature page will be completed with normal size 12 font.  However, it is possible to have some excessively long titles that will not properly fit.  To provide for this circumstance, re-define the macro files using either of these

\begin{Verbatim}
\renewcommand{\NPSsigfont}{\small}
\renewcommand{\NPSsigfont}{\footnotesize}
\end{Verbatim}

These options give size 11 and size 10 fonts, respectively.  This font option only applies to the signature page font.



\section{Marking FOUO and Classified Documents}\label{sec:classified}
The NPS \LaTeX{} template has been designed so that it can be used
for creating documents that are 
classified at any classification level. As a general rule, you only
create a classified document on a system that has been approved for
processing classified data at a particular classification level. You
should also arrange for the NPS security office to install \LaTeX{} on
the system, rather than installing it yourself. However, once you have
a system that is appropriately set up, the template can save a
substantial amount of time over the alternative.

Very little support is provided for assisting you to use \LaTeX{} in
a classified setting. This should be considered an experimental
and unsupported feature, but a description of the template's features is
provided for the adventurous power-user that insists
on attempting the feat.

In general, preparing a FOUO or classified document requires a few
changes from preparing an unclassified document:
\begin{enumerate}
\item The security banner must be set.
\item An appropriate distribution statement must be selected.
\item The SF-298 form must be properly labeled.
\item Paragraphs and captions must be labeled.
\item Citations must be appropriately labeled.
\end{enumerate}


\subsection{Setting the Security Banner}
The security banner is the notation that is printed at the top and
bottom of each page of your classified or otherwise restricted
document. Use the |\securitybanner{}| macro to set the banner. Here is
an example from our fictitiously classified document:

\begin{Verbatim}
    \securitybanner{F//MM//SPECIAL//TOM FOOLERY}
\end{Verbatim}

This document is classified F (for FUN) and it contains three
additional restrictions: MM (Mickey Mouse), SPECIAL, and TOM FOOLERY.

For unclassified theses with FOUO material, set the banner using:
\begin{Verbatim}
    \securitybanner{FOR OFFICIAL USE ONLY}
\end{Verbatim}
This will be printed only on those pages that hold 
paragraphs, figures, and tables that you have marked as FOUO.


\subsection{Labeling the SF-298}
The NPS \LaTeX{} template automatically creates a SF-298 form for
you. When you create a classified document you need to determine the
classification of the document's SF-298 form, its abstract, and the
report itself. In order for the SF-298 to be unclassified the
document's title and abstract must be unclassified. However it is
possible to have a classified document with an unclassified abstract
and an unclassified title. In this case the SF-298 may also be
unclassified. However, before you make a determination, you may wish
to speak with your sponsor or with the Site Security Officer. 

The report classification, abstract classification, and classification
of the SF-298 are indicated with these three macros:
\begin{Verbatim}
    \ReportClassification{Fun}
    \AbstractClassification{Jolly}
    \PageClassification{Amusing}
\end{Verbatim}

In this case the report is classified as Fun, the abstract is classified
as Jolly, and the SF-298 is classified as Amusing. Of course, actual 
classified documents should be classified with actual classifications.


\subsection{Labeling paragraphs}
(U) In a classified document, each paragraph should be proceeded with an
appropriate classification level. For example, this paragraph is
explicitly labeled as being unclassified. It appears in the source of
this document as:

\begin{quotation}
\begin{Verbatim}[fontsize=\small]
(U) In a classified document, each paragraph should be proceeded with an
appropriate classification level. For example, this paragraph is
explicitly labeled as being unclassified. It appears in the source of
this document as:
\end{Verbatim}
\end{quotation}

As you can see from the example above, paragraph classification
labeling must be done manually.

For FOUO material, paragraphs should be placed inside a special
environment, the security marking or |smark| environment.
\begin{quotation}
\begin{Verbatim}[fontsize=\small]
\begin{smark}[(FOUO)]
This paragraph is unclassified and has a FOUO restriction.
Only put one paragraph at a time in this environment.
Each paragraph must be marked separately.
\end{smark}
\end{Verbatim}
\end{quotation}

This environment places the appropriate marking on the page where
the paragraph gets typeset, marking the page as containing FOUO material. 
Unlike classified documents, we don't mark every page of the thesis, just
those containing FOUO material. 

\subsection{Labeling captions}
To mark classified or FOUO content in floats (figures or tables), use
the |smarkenv| environment:

\begin{quotation}
\begin{Verbatim}[fontsize=\small]
\begin{figure}
\begin{smarkenv}{(FOUO)}
   \includegraphics[width=3in]{images/fouo_graphic.jpg}
\end{smarkenv}
\caption{[Figure with unrestricted caption, but FOUO content]}
\label{fig:mark}
\end{figure}
\end{Verbatim}
\end{quotation}
Unlike paragraph-level marking with |smark|, the float marking using |smarkenv| 
will mark both the top and bottom of the figure, as is required.

For FOUO caption marking, use the abbreviation of the classification, like |(FOUO)|.
For classified content, however, you should spell out the marking in full, like |(AMUSING//JOLLY)|.

\begin{description}
\item[\caution{Note:}]
For FOUO documents, the |smarkenv| macro will not appropriately mark
captions, sections, subsections and similar.
In particular, the table of contents, list of figures, \etc will not be automatically
marked has holding FOUO material, which is strictly required if a caption is, itself, FOUO. 
If you have a caption or a section title has FOUO content, you will have to manually
mark front-matter pages after your PDF is generated.\\
This is not a problem in classified documents, where the front-matter 
will get automatically marked with the overall document classification.
\end{description}

\subsection{Labeling References}
For classified theses, all your references should be marked. You can achieve this
by modifying your |.bib| file to include the marking of the reference:

\begin{quotation}
\begin{Verbatim}
@electronic{IEEEhowto:IEEEtranpage,
  author        = "Michael Shell",
  title         = "{IEEE}tran Homepage",
  url           = "http://www.michaelshell.org/tex/ieeetran/",
  year          = "2008",
  classification = "(F//MM)"
}
\end{Verbatim}
\end{quotation}

Then, you must inform Bib\TeX{} that you are using marked references using
a bibliography control directive, like the one inside |examples/nps_class_meta.bib|,
which reads:
\begin{quotation}
\begin{Verbatim}
@IEEEtranBSTCTL{NPS:BSTctl,
  CTLclassification_show = "1",
  CTLclassification_unmarked = "(U)"
}
\end{Verbatim}
\end{quotation}

This tells Bib\TeX{} (a) to show bibliography entry security markings, and
(b) to assume all unmarked entries are unclassified so they will
be marked (U). Thus, it will show the appropriate marking, if the
|classification| entry is populated in the |.bib| file, otherwise it will
mark the entry with (U).

Finally, you must tell Bib\TeX{} where to locate the control file and
the marked |.bib| file, using a command in your thesis, like:
\begin{quotation}
\begin{Verbatim}
\NPSbibliography{nps_class_meta,thesis}
\end{Verbatim}
\end{quotation}

This assumes the |nps_class_meta.bib}| and |thesis.bib|
hold the directives and references. In truth, you could
combine these files.

\begin{description}
\item[\caution{Note:}]
FOUO bibliography entries are not currently supported, since the
there is no way to mark the pages where the FOUO citations
get typeset. This is due to the build process: it is unknown
until quite late where a citation is placed, so its not possible
to detect that page 102 rather than 103 holds a FOUO citation.
If you have FOUO bibliography entries, you will have to manually
mark pages after your PDF is generated.\\
This is not a problem in classified documents, as every page gets
marked with the overall document classification. 
\end{description}

\section{Additional Software}
This section discusses additional software that you may find useful
when preparing your document.
\subsection{Citation Management Software}
Organizing your thesis citations is critical to a successful thesis.  Legacy techniques included using index cards.
In modern times, software is available to help you accomplish this task.  A complete list of the available options is
at \url{http://en.wikipedia.org/wiki/Comparison_of_reference_management_software} .  NPS has a site-license for Refworks.
Other highly recommended options are Zotero and Mendeley.  See \url{http://www.zotero.org/} and \url{http://www.mendeley.com/}
for additional details.
   
\subsection{Revision Control Systems and Subversion}
Revision control software such as subversion (|svn|), mercurial (|hg)|, |git|, and others are excellent modern choices.  
Consult their websites to determine which one best suits your needs.

You will note that \LaTeX{} creates many temporary files. These files should \emph{not} be
included in your subversion repository. Because they are generated on a
per-machine basis, you can get conflicts if different files are
created and then committed on different machines.

If you are using subversion to manage your thesis, you should instruct it to ignore these files.  This
can be done by issuing the following commands:

\begin{Verbatim}
        svn propget svn:ignore . > /tmp/ignore
        echo thesis.pdf >> /tmp/ignore
        echo '*.ain' >> /tmp/ignore
        echo '*.aux' >> /tmp/ignore
        echo '*.asy' >> /tmp/ignore
        echo '*.bbl' >> /tmp/ignore
        echo '*.blg' >> /tmp/ignore
        echo '*.lof' >> /tmp/ignore
        echo '*.log' >> /tmp/ignore
        echo '*.lot' >> /tmp/ignore
        echo '*.sow' >> /tmp/ignore
        echo '*.toc' >> /tmp/ignore
        echo '*.zip' >> /tmp/ignore
        sort /tmp/ignore|uniq|grep .|svn propset svn:ignore -F - .
        svn propget svn:ignore .
        rm -f /tmp/ignore
\end{Verbatim}



\section{Going Further}
If you are interested, feel free to review the file
|npsthesis.cls|. A great deal of effort has gone into making this
file both readable and understandable. You will find additional
commands in this file and you may even have thoughts on changes to
make. Please let us know what you come up with!


